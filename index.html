 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FIXME</title>


    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="leaflet.css">

    <!-- for the time being, externalize later -->
    <style>
        html, body{
            height: 100%;
        }
        #map{
            height: 80%;
            width: 100%;
            background-color: yellow;
        }
        #footer{
            height: 20%;
            background-color: cyan;
        }
        #settings{
            float: left;
            height: 100%;
            width: 50%;
        }
        #dropzone{
            float: right;
            height: 100%;
            width: 50%;
            background-color: blueviolet;
        }

    </style>

</head>

<body>
    <div id="map"></div>
    <div id="footer">
        <div id="settings">Settings</div>
        <div id="dropzone" ondrop="drop(event);" ondragover="dragOver(event)" ondragend="dragEnd(event)">Drop File here</div>

    </div>



    <div id="testbox"></div>

    <script src="leaflet.js"></script>
    <script src="wsjt-parser.js"></script>
    <script src="representations.js"></script>


    <!-- debug -->
    <script src="vars.js"></script>


    <!-- for the time being, externalize later -->
    <script>
        var map = L.map('map').setView([47.18926, 8.17503], 10);
        var tileLayer = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZm94dHJvdHQxMiIsImEiOiJjamMzamRmd3gwdDI5MzNyNmYyYzR3MXo2In0.zliegd2CbZ_LzzShoSQCvw', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiZm94dHJvdHQxMiIsImEiOiJjamMzamRmd3gwdDI5MzNyNmYyYzR3MXo2In0.zliegd2CbZ_LzzShoSQCvw'
        });
        tileLayer.addTo(map);
        var controls = L.control.layers({"Mapbox Base": tileLayer},{},{collapsed: false});
        controls.addTo(map)

        function dragOver(ev) {
            ev.preventDefault();
        }

        function dragEnd(ev) {
            ev.preventDefault();
        }

        //handler for the drop and drag
         function drop(ev) {
            ev.preventDefault();
            console.log("Dropped file");

             // If dropped items aren't files, reject them
            var dt = ev.dataTransfer;
            if (dt.items) {
                // Use DataTransferItemList interface to access the file(s)
                for (var i=0; i < dt.items.length; i++) {
                    if (dt.items[i].kind == "file") {
                        var f = dt.items[i].getAsFile();
                        console.log("... file[" + i + "].name = " + f.name);
                        parseDroppedFile(f);
                    }
                }
            } else {
                // Use DataTransfer interface to access the file(s)
                for (var i=0; i < dt.files.length; i++) {
                    console.log("... file[" + i + "].name = " + dt.files[i].name);
                    parseDroppedFile(f);
                }
            }
        }

        function parseDroppedFile(file){
            console.log("Parsing dropped file");
            console.log(file);
            var reader = new FileReader();
            reader.readAsText(file);
            reader.onloadend = function(e){
                console.log(e);
                console.log(reader.result)
                parseText(reader.result, file.name);
            }
        }

        function parseText(text, name){
            var wsjt_timeHashmap = wsjt_partition_log(text);

            var log = new LogRepresentation(wsjt_timeHashmap, name);
            log.addTo(map, controls)

            //zoom map to bounds
            map.fitBounds(log.getBounds());

        }







        // FOR YOUR PLEASURE
        // COMMENT IN PRODUCTION
        parseText(log1, "Demo Log");
    </script>

</body>
</html>
